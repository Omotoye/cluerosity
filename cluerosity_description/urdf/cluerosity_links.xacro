<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro">

    <!-- 
        +===========================+
        |      Fixed Link Macro     |
        +==========================+ 
    -->

    <xacro:macro name="fixed_link" params="name link_xyz link_rpy mesh_name joint_xyz joint_rpy parent">
        <link name="${name}">
            <xacro:mesh_link 
                xyz="${link_xyz}" rpy="${link_rpy}" 
                mesh_name="${mesh_name}"/>
        </link>

        <joint name="${name}_joint" type="fixed">
            <parent link="${parent}" />
            <child link="${name}" />
            <origin xyz="${joint_xyz}" rpy="${joint_rpy}" />
        </joint>
    </xacro:macro>


    <!-- 
        +==============================================+
        |      Base Link and Base footprint Macro      |
        +==============================================+ 
    -->

    <xacro:macro name="base_link" params="mesh_name">
        <link name="base_link">
            <xacro:mesh_link 
                xyz="0 0 0.15" rpy="0 ${PI} ${-PI/2}" 
                mesh_name="${mesh_name}"/>
            <xacro:box_collision 
                xyz="0 0 0.075" rpy="0 0 0"  
                box_size="0.8 0.4 0.15"/>
            <xacro:box_collision 
                xyz="-0.325 0.14 0.2" rpy="0 0 0"  
                box_size="0.15 0.12 0.1"/>
            <xacro:box_collision 
                xyz="0.45 0.1 0.05" rpy="0 0 0"  
                box_size="0.1 0.1 0.05"/>
            <xacro:link_inertia 
                xyz="0 0 0.075" rpy="0 0 0"  
                mass="56.77662104" 
                ixx="2.64" ixy="0.221" ixz="0.046"  
                iyy="0.907" iyz="-0.237"  izz="3.303"/>
        </link>

        <!-- Base footprint is on the ground under the robot -->
        <link name="base_footprint" />

        <joint name="base_footprint_joint" type="fixed">
            <origin xyz="0 0 -0.14" rpy="0 0 0" />
            <parent link="base_link" />
            <child link="base_footprint" />
        </joint>
    </xacro:macro>


    <!-- 
        +==================================+
        |   Sensor Gimbal links Macro     |
        +================================+ 
    -->

    <!-- Gimbal Base  -->
    <xacro:macro name="gimbal_base">
        <link name="gimbal_base">
            <xacro:box_link 
                xyz="0 0 0.025" rpy="0 0 0" 
                box_size="0.1 0.1 0.05"
                material_name="dark_gray"/>
        </link>

        <joint name="gimbal_base_joint" type="fixed">
            <parent link="base_link" />
            <child link="gimbal_base" />
            <origin xyz="0.340 -0.140 0.1" rpy="0 0 ${PI/2}" />
        </joint>
    </xacro:macro>

    <!-- Gimbal Axle -->
    <xacro:macro name="gimbal_axle" params="mesh_name">
        <link name="gimbal_axle">
            <xacro:mesh_link 
                xyz="0 0 0" rpy="0 0 0" 
                mesh_name="${mesh_name}"/>
        </link>

        <joint name="gimbal_axle_joint" type="continuous">
            <parent link="gimbal_base" />
            <child link="gimbal_axle" />
            <origin xyz="0 0 0" rpy="0 0 0" />
            <axis xyz="0 0 1" rpy="0 0 0" />
        </joint>
    </xacro:macro>

    <!-- Sensor Housing -->
    <xacro:macro name="sensor_housing" params="mesh_name">
        <link name="sensor_housing">
            <xacro:mesh_link 
                xyz="0 0 0.053" rpy="0 0 0" 
                mesh_name="${mesh_name}"/>
        </link>

        <joint name="sensor_housing_joint" type="revolute">
            <parent link="stepper_motor" />
            <child link="sensor_housing" />
            <origin xyz="0.122 0 0" rpy="0 0 0" />
            <axis xyz="1 0 0" rpy="0 0 0" />
            <limit effort="1000.0" lower="-0.35" upper="0.35" velocity="0.5" />
        </joint>
    </xacro:macro>

</robot>
